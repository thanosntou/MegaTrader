"use strict";!function(t,e){const i=2,s={onSuccess:[],onFailure:[],onPaymentDetected:[]};(!t.BuyWithCrypto||t.BuyWithCrypto.version<i)&&function(){function n(t,e){this.root="https://commerce.coinbase.com",this.messageOrigin="https://commerce.coinbase.com:443",this.state="none",this._listeningForEvents=!1,this._pauseTimeout=0,this.preloadModal=this.preloadModal.bind(this),this.showModal=this.showModal.bind(this),this.handleMessage=this.handleMessage.bind(this),t&&t instanceof HTMLElement&&this.install(t,e)}n.version=i,n.findButtonAndInstall=function(e){for(let i=0;e&&i<3;i++)if((e=e.previousSibling)&&1===e.nodeType){if("A"===e.tagName&&(e.classList.contains("buy-with-crypto")||e.classList.contains("donate-with-crypto"))){let i=new t.BuyWithCrypto;i.install(e);break}if("SCRIPT"===e.tagName)break}},n.registerCallback=function(t,e){s[t].push(e)};const o=n.prototype;if(o.triggerCallbacks=function(t,e){const i=s[t];if(i)for(let t=0;t<i.length;t++)i[t](e)},o.install=function(i,s){if(this.link)throw new Error("payment button already installed");"object"!=typeof s&&(s=null);let n=this.extractProductId(i),o=this.extractChargeCode(i);if(o)this.code=o;else{if(!n)return!1;this.checkout=n,this.product=n}return this.link=i,this.buttonId=i.id||"bwc-"+t.Math.floor(1e16*t.Math.random()).toString(16),this.params=t.Object.assign({buttonId:this.buttonId},i.dataset),s&&(s.omitStyles||!1===s.styles)||this.turnIntoButton(i),i.addEventListener("click",this.showModal,!1),i.addEventListener("mouseover",this.preloadModal,!1),function(t){if(!e.head.querySelector('link[href="'+t+'"]')){let i=e.createElement("link");i.rel="stylesheet",i.href=t,e.head.appendChild(i)}}(this.root+"/v1/button.css"),!0},o.uninstall=function(){this.link&&(this._hideSpinner(),this.link.removeEventListener("click",this.showModal,!1),this.link.removeEventListener("mouseover",this.preloadModal,!1),this.link=null),this._tearDownModal()},o._tearDownModal=function(){this.state="none",this.modalContainer&&(this.modalContainer.parentNode===e.body&&e.body.removeChild(this.modalContainer),this.modalContainer=null),this.iframe=null,this._listeningForEvents&&(t.removeEventListener("message",this.handleMessage,!1),this._listeningForEvents=!1),this._pauseTimeout&&(clearTimeout(this._pauseTimeout),this._pauseTimeout=0)},o.loadModal=function(){let i;if(this.code)i="/embed/charges/"+encodeURI(this.code);else{if(!this.checkout)return;i="/embed/checkout/"+encodeURI(this.checkout)}if(this._listeningForEvents||(t.addEventListener("message",this.handleMessage,!1),this._listeningForEvents=!0),this._pauseTimeout&&(clearTimeout(this._pauseTimeout),this._pauseTimeout=0),!this.modalContainer){let t=e.createElement("div");t.classList.add("bwc-modal-container","bwc-fade"),t.style.display="none",t.dataset.buttonId=this.buttonId,e.body.appendChild(t),this.modalContainer=t;let i=e.createElement("div");i.classList.add("bwc-dimmer"),this.modalContainer.appendChild(i)}this.iframe||(this.state="preloading",this.iframe=function(i,s,n){let o,a={};for(let t in n)"product"!==t&&"checkout"!==t&&"charge"!==t&&n.hasOwnProperty(t)&&(a[t]=n[t]);a.version="201807";try{o=t.top.location.origin}catch(e){o=t.location.origin}a.origin=o;let r=e.createElement("iframe");return r.allowTransparency=!0,r.frameBorder="no",r.scrolling="no",r.src=i+s+"?"+function(e){let i=[],s=t.encodeURIComponent;for(let t in e)e.hasOwnProperty(t)&&i.push(s(t)+"="+s(e[t]));return i.join("&")}(a),r.classList.add("bwc-iframe"),r}(this.root,i,this.params),this.modalContainer.appendChild(this.iframe))},o.preloadModal=function(){this.link&&this.link.removeEventListener("mouseover",this.preloadModal,!1),this.modalContainer||this.loadModal()},o.showModal=function(t){if(t){if(t.button>0||t.ctrlKey||t.shiftKey||t.metaKey)return;t.preventDefault&&t.preventDefault()}this.link&&this.link.classList.contains("disabled")||(this.modalContainer||this.loadModal(),"preloading"===this.state?(this.state="loadThenShow",this._showSpinner()):"hidden"!==this.state&&"fading"!==this.state||(this.state="show",this._pauseTimeout&&(clearTimeout(this._pauseTimeout),this._pauseTimeout=0),this._fadeIn()))},o.hideModal=function(t){"show"===this.state&&this._fadeOut(),!0!==t?this._pauseTimeout||(this._pauseTimeout=setTimeout(this._expired.bind(this),3e4)):this._tearDownModal()},o._expired=function(){this._pauseTimeout=0,"hidden"===this.state&&this._tearDownModal()},o.handleMessage=function(t){if(function(t){if(/^[a-zA-Z0-9:\/.-]+$/.test(t))return/^https?:\/\//i.test(t)||(t="https://"+t),/:\d+$/.test(t)||(t+=/^https:/i.test(t)?":443":":80"),t.toLowerCase()}(t.origin)===this.messageOrigin&&t.data.buttonId===this.buttonId)switch(t.data.event){case"checkout_modal_loaded":"preloading"===this.state?this.state="hidden":"loadThenShow"===this.state&&(this.state="show",this._hideSpinner(),this._fadeIn());break;case"checkout_modal_closed":this.iframe&&this.iframe.contentWindow===t.source&&this.hideModal(!0);break;case"charge_confirmed":this.triggerCallbacks("onSuccess",t.data);break;case"charge_failed":this.triggerCallbacks("onFailure",t.data);break;case"payment_detected":this.triggerCallbacks("onPaymentDetected",t.data)}},o.extractCheckoutId=function(t){if(t){let e=/\/(?:products|checkout)\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/i.exec(t.href);if(e)return e[1];if(t.dataset){let e=t.dataset.checkout||t.dataset.product;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return t.href=this.root+"/checkout/"+e,e}}},o.extractProductId=o.extractCheckoutId,o.extractChargeCode=function(t){if(t){let e=/\/charges\/([0-9A-Z]{8})(?![0-9A-Z])/i.exec(t.href);if(e)return e[1].toUpperCase();if(t.dataset){let e=t.dataset.charge;if(/^[0-9A-Z]{8}$/i.test(e))return t.href=this.root+"/charges/"+e,e}}},o.turnIntoButton=function(t){let i,s=t.classList.contains("donate-with-crypto"),n=!0;for(let e=t.firstChild;e;e=e.nextSibling)if(3!==e.nodeType&&8!==e.nodeType&&(n=!1),1===e.nodeType&&"SPAN"===e.tagName){i=e;break}if(!i){i=e.createElement("span");let o=n&&t.textContent.trim();for(o||(o=(s?"Donate":"Buy")+" with Crypto"),i.textContent=o;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(i)}""===t.rel&&""===t.target&&(t.rel="noopener noreferrer",t.target="_blank")},o._fadeIn=function(){let t=this.modalContainer;!t||"block"===t.style.display&&"fading"!==this.state||(t.classList.add("bwc-fade"),t.style.display="block",setTimeout(function(){t.classList.remove("bwc-fade")},50))},o._fadeOut=function(){let t=this.modalContainer;t&&"block"===t.style.display&&(t.classList.add("bwc-fade"),this.state="fading",setTimeout(function(){"fading"===this.state&&(this.state="hidden",t.style.display="none")}.bind(this),800))},o._showSpinner=function(){this.link&&(this.link.classList.add("loading"),this._spinner||(this._spinner=e.createElement("div"),this._spinner.classList.add("spinner"),this.link.appendChild(this._spinner)))},o._hideSpinner=function(){this.link&&(this.link.classList.remove("loading"),this._spinner&&(this.link.removeChild(this._spinner),this._spinner=null))},t.BuyWithCrypto=n,e.currentScript.src.split("?").length>1){const i=e.currentScript.src.split("?")[1],s=function(t){const e=t.split("&"),i={};for(let t=0;t<e.length;t++){const s=e[t].split("="),n=decodeURIComponent(s[0]),o=decodeURIComponent(s[1]);if(void 0===i[n])i[n]=decodeURIComponent(o);else if("string"==typeof i[n]){const t=[i[n],decodeURIComponent(o)];i[n]=t}else i[n].push(decodeURIComponent(o))}return i}(i),n=t[s.onload];n&&n.constructor&&n.call&&n.apply&&n()}}();let n=e.currentScript;n&&t.BuyWithCrypto.findButtonAndInstall(n)}(this,this.document);